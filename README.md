# Сервис автоматического назначения ревьюверов на Pull Request

Микросервис для автоматического назначения ревьюверов на Pull Request'ы (PR) в командах.

## Описание

Сервис реализует все эндпоинты из OpenAPI-спецификации и дополнительные требования задания:

- Автоматическое назначение до 2 активных ревьюверов из команды автора PR.
- Идемпотентный merge PR.
- Переназначение ревьюверов с выбором случайного активного участника из его команды.
- Массовая деактивация пользователей с безопасным переназначением открытых PR (≤100 мс).
- Эндпоинт статистики по количеству назначений.

## Быстрый старт

Проект запускается одной командой без ручных настроек:

```bash
docker compose up --build
```
Сервис будет доступен на [http://localhost:8080](http://localhost:8080).

## Структура проекта

Используется архитектура Clean Architecture:

```
reviewer_service/
├── cmd/server/           # Точка входа
├── internal/
│   ├── domain/           # Доменные сущности (User, Team, PullRequest)
│   ├── handlers/         # HTTP-обработчики
│   ├── middleware/       # Промежуточное ПО
│   ├── repository/       # Доступ к данным (PostgreSQL)
│   └── service/          # Бизнес-логика
├── migrations/           # Миграции БД
├── tests/e2e/            # E2E-тесты
├── Dockerfile
├── docker-compose.yml
├── go.mod
└── README.md
```

## Требования

- Docker 20.10+
- Docker Compose v2+
- Go 1.23+ (только для сборки)

## Тестирование

### E2E-тесты

Запуск интеграционных тестов:

```bash
# Windows
tests/e2e/run.bat

# Linux/macOS
cd tests/e2e && ./run.sh
```

Тесты проверяют 

- Создание команд
- Создание PR с автоматическим назначением ревьюверов
- Мерж PR
- Обработку ошибок

### Линтинг кода

Проект настроен на `golangci-lint`:

```bash
golangci-lint run ./...
```

Конфигурация: `.golangci.yml`

## Зависимости

- PostgreSQL 16
- [github.com/lib/pq](https://github.com/lib/pq) — драйвер PostgreSQL для Go
- [github.com/golang-migrate/migrate](https://github.com/golang-migrate/migrate) — управление миграциями

## Допущения

1. **Пользователь принадлежит только одной команде**  

2. **Имя модуля `reviewer_service` вместо `pr-reviewer-service`**

3. **Автор PR может быть назначен ревьювером при переназначении**  
   В требованиях сказано исключать автора только при **создании** PR.

4. **Миграции применяются при старте сервиса**  
   Это соответствует условию: «миграции должны применяться при выполнении `docker-compose up`».

5. **Ответы возвращают все поля из OpenAPI**  
   Включая `createdAt`, `mergedAt` в формате ISO 8601 с наносекундами (стандарт Go).
